{% load static %}

<form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
    {% csrf_token %}
    
    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Información del Vehículo</h6>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label for="dominio">Dominio*</label>
                            <input type="text" class="form-control" id="dominio" name="dominio" value="{{ vehiculo.dominio|default:'' }}" required>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="marca">Marca*</label>
                            <select class="form-control" id="marca" name="marca" required>
                                <option value="">Seleccione una marca</option>
                                {% for marca in marcas %}
                                    <option value="{{ marca.id }}" {% if vehiculo.marca == marca.id %}selected{% endif %}>{{ marca.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="modelo">Modelo*</label>
                            <select class="form-control" id="modelo" name="modelo" required>
                                <option value="">Seleccione un modelo</option>
                                {% for modelo in modelos %}
                                    <option value="{{ modelo.id }}" {% if vehiculo.modelo == modelo.id %}selected{% endif %}>{{ modelo.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <label for="sucursal">Sucursal*</label>
                            <select class="form-control" id="sucursal" name="sucursal" required>
                                <option value="">Seleccione una sucursal</option>
                                {% for sucursal in sucursales %}
                                    <option value="{{ sucursal.id }}" {% if vehiculo.sucursal == sucursal.id %}selected{% endif %}>{{ sucursal.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="tipo">Tipo*</label>
                            <input type="text" class="form-control" id="tipo" name="tipo" value="{{ vehiculo.tipo|default:'' }}" required>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="anio">Año*</label>
                            <input type="number" class="form-control" id="anio" name="anio" value="{{ vehiculo.anio|default:'' }}" required min="1900" max="2100">
                        </div>
                        <div class="form-group col-md-2">
                            <label for="kilometraje">Kilometraje</label>
                            <input type="number" class="form-control" id="kilometraje" name="kilometraje" value="{{ vehiculo.kilometraje|default:'' }}">
                        </div>
                        <div class="form-group col-md-2">
                            <label for="activo">Activo*</label>
                            <select class="form-control" id="activo" name="activo" required>
                                <option value="Si" {% if vehiculo.activo == 'Si' %}selected{% endif %}>Sí</option>
                                <option value="No" {% if vehiculo.activo == 'No' %}selected{% endif %}>No</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <label for="fecha_vtv">Fecha VTV</label>
                            <input type="date" class="form-control" id="fecha_vtv" name="fecha_vtv" value="{{ vehiculo.fecha_vtv|default:'' }}">
                        </div>
                        <div class="form-group col-md-3">
                            <label for="alerta_vtv">Alerta VTV</label>
                            <input type="text" class="form-control" id="alerta_vtv" name="alerta_vtv" value="{{ vehiculo.alerta_vtv|default:'' }}">
                        </div>
                        <div class="form-group col-md-3">
                            <label for="fecha_ruta">Fecha Ruta</label>
                            <input type="date" class="form-control" id="fecha_ruta" name="fecha_ruta" value="{{ vehiculo.fecha_ruta|default:'' }}">
                        </div>
                        <div class="form-group col-md-3">
                            <label for="alerta_ruta">Alerta Ruta</label>
                            <input type="text" class="form-control" id="alerta_ruta" name="alerta_ruta" value="{{ vehiculo.alerta_ruta|default:'' }}">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <label for="fecha_seguro">Fecha Seguro</label>
                            <input type="date" class="form-control" id="fecha_seguro" name="fecha_seguro" value="{{ vehiculo.fecha_seguro|default:'' }}">
                        </div>
                        <div class="form-group col-md-3">
                            <label for="alerta_seguro">Alerta Seguro</label>
                            <input type="text" class="form-control" id="alerta_seguro" name="alerta_seguro" value="{{ vehiculo.alerta_seguro|default:'' }}">
                        </div>
                        <div class="form-group col-md-3">
                            <label for="tipo_service">Tipo de Service</label>
                            <select class="form-control" id="tipo_service" name="tipo_service">
                                <option value="">Seleccione un tipo de service</option>
                                {% for tipo in tipos_service %}
                                    <option value="{{ tipo.id }}" {% if vehiculo.tipo_service == tipo.id %}selected{% endif %}>{{ tipo.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="alerta_service">Alerta Service</label>
                            <input type="text" class="form-control" id="alerta_service" name="alerta_service" value="{{ vehiculo.alerta_service|default:'' }}">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <label for="observaciones">Observaciones</label>
                            <textarea class="form-control" id="observaciones" name="observaciones" rows="2">{{ vehiculo.observaciones|default:'' }}</textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card shadow mb-4">
                <div class="card-body">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save fa-sm text-white-50"></i>
                        Guardar
                    </button>
                    <a href="{% url 'ver_vehiculos' %}" class="btn btn-secondary">
                        <i class="fas fa-times fa-sm text-white-50"></i>
                        Cancelar
                    </a>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
// Validación del formulario
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

// Actualizar modelos cuando cambia la marca
$('#marca').change(function() {
    var marcaId = $(this).val();
    if (marcaId) {
        $.ajax({
            url: `/parametros/modelos/por-marca/${marcaId}/`,
            type: 'GET',
            success: function(data) {
                var modeloSelect = $('#modelo');
                modeloSelect.empty();
                modeloSelect.append('<option value="">Seleccione un modelo</option>');
                data.forEach(function(modelo) {
                    modeloSelect.append(`<option value="${modelo.id}">${modelo.nombre}</option>`);
                });
            }
        });
    } else {
        $('#modelo').empty().append('<option value="">Seleccione un modelo</option>');
    }
});
</script> 